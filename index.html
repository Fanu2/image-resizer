<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pica Image Resizer with Details</title>
  <script src="https://unpkg.com/pica@8.0.0/dist/pica.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button, a, label { display: block; margin: 10px 0; }
    .preview-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 300px;
    }
    canvas, img {
      max-width: 100%;
      border: 1px solid #ccc;
    }
    .label {
      margin-top: 8px;
      font-weight: bold;
    }
    .details {
      margin-top: 4px;
      font-size: 0.9em;
      color: #555;
      text-align: center;
    }
  </style>
</head>
<body>

  <h2>üñºÔ∏è Pica Image Resizer with Details</h2>

  <label>Select image:</label>
  <input type="file" id="fileInput" accept="image/*" />

  <label>Target Width (px):</label>
  <input type="number" id="widthInput" value="300" min="10" step="10" />

  <div class="preview-container">
    <div class="preview">
      <span class="label">Original Image</span>
      <img id="originalPreview" />
      <div id="originalDetails" class="details"></div>
    </div>
    <div class="preview">
      <span class="label">Resized Image</span>
      <canvas id="canvas"></canvas>
      <div id="resizedDetails" class="details"></div>
    </div>
  </div>

  <a id="download" download="resized.png" style="display:none">‚¨áÔ∏è Download Resized Image</a>

  <script>
    const fileInput = document.getElementById("fileInput");
    const widthInput = document.getElementById("widthInput");
    const canvas = document.getElementById("canvas");
    const download = document.getElementById("download");
    const originalPreview = document.getElementById("originalPreview");
    const originalDetails = document.getElementById("originalDetails");
    const resizedDetails = document.getElementById("resizedDetails");
    const picaInstance = pica();

    // Helper to format bytes to KB with two decimals
    function formatKB(bytes) {
      return (bytes / 1024).toFixed(2) + " KB";
    }

    fileInput.addEventListener("change", async () => {
      const file = fileInput.files[0];
      if (!file) return;

      const width = parseInt(widthInput.value);
      if (!width || width < 10) {
        alert("Please enter a valid width");
        return;
      }

      const img = new Image();
      img.onload = async () => {
        // Show original image + details
        originalPreview.src = img.src;
        originalDetails.textContent = `Dimensions: ${img.width} √ó ${img.height} px | Size: ${formatKB(file.size)}`;

        // Resize logic
        const height = Math.round(img.height * (width / img.width));
        const offscreenCanvas = document.createElement("canvas");
        offscreenCanvas.width = width;
        offscreenCanvas.height = height;

        await picaInstance.resize(img, offscreenCanvas);

        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(offscreenCanvas, 0, 0);

        // Create blob for download + size info
        canvas.toBlob(blob => {
          const url = URL.createObjectURL(blob);
          download.href = url;
          download.style.display = "inline";

          resizedDetails.textContent = `Dimensions: ${width} √ó ${height} px | Size: ${formatKB(blob.size)}`;
        }, "image/png");
      };

      img.src = URL.createObjectURL(file);
    });
  </script>

</body>
</html>
